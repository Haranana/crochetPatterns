<!DOCTYPE html>
<html lang="pl-PL" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="#{showAllPosts.name}">Wszystkie wpisy</title>
    <link href="../static/css/style.css" th:href="@{/css/style.css}" rel="stylesheet"/>
    <button type="button" onclick="window.location.href='http://localhost:8080/main'">Strona główna</button>
    <hr>
</head>
<body>
<!-- Formularz wyszukiwania -->
<form action="/allPosts" method="get">
    <input type="text" name="search" placeholder="Szukaj w tytule..." th:value="${search}"/>
    <input type="hidden" name="sort" th:value="${sort}"/>
    <input type="hidden" name="size" th:value="${size}"/>
    <button type="submit">Szukaj</button>
</form>
<form action="/allPosts" method="get">
    <input type="text" name="search" placeholder="Szukaj w tytule..." th:value="${search}"/>
    <!-- select tagów -->
    <select name="tagId">
        <option value="">-- dowolny tag --</option>
        <option th:each="tag : ${allTags}"
                th:value="${tag.id}"
                th:text="${tag.name}">
        </option>
    </select>
    <input type="hidden" name="size" th:value="${size}"/>
    <!-- ... itp. -->
    <button type="submit">Filtruj</button>
</form>
<ul>
    <!-- Iterujemy listę postów -->
    <li th:each="post : ${posts}">
        <a th:href="@{/showPost(postId=${post.id})}">
            <strong th:text="${post.title}">Tytuł wpisu</strong><br>
            <span th:text="${post.description}">Opis wpisu</span>
        </a>
        <br>

        <!-- Liczba polubień: wyciągamy z mapy postLikesCountMap -->
        <span>Liczba polubień:
            <b th:text="${postLikesCountMap[post.id]}">0</b>
        </span>
        <br>

        <!-- Przyciski Like/Unlike -->
        <div th:if="${userLikedPosts.contains(post.id)}">
            <form th:action="@{/post/{id}/unlike(id=${post.id})}" method="post">
                <button type="submit">Unlike</button>
            </form>
        </div>
        <div th:unless="${userLikedPosts.contains(post.id)}">
            <form th:action="@{/post/{id}/like(id=${post.id})}" method="post">
                <button type="submit">Like</button>
            </form>
        </div>
        <br>
    </li>
</ul>

<!-- Nawigacja stron -->
<span th:each="number : ${numbers}">
    <a th:if="${number} != -1"
       th:href="@{/allPosts(size=${size}, page=${number}, sort=${sort}, search=${search})}"
       th:text="${number + 1}"></a>
    <span th:unless="${number} != -1">...</span>
</span>

<a th:href="@{/main}" th:text="#{showAllPosts.menuReturn}">Powrót do menu</a>
</body>
</html>