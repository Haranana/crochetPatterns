<!DOCTYPE html>
<html lang="pl-PL" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="#{showAllPosts.name}">Wszystkie wpisy</title>
    <link href="../static/css/style.css" th:href="@{/css/style.css}" rel="stylesheet"/>
    <button type="button" onclick="window.location.href='http://localhost:8080/main'">Strona główna</button>
    <hr>
</head>
<body>

<!-- Formularz do wyszukiwania i sortowania -->
<form action="/allPosts" method="get">
    <!-- Wyszukiwanie po tytule -->
    <input type="text" name="search" placeholder="Szukaj w tytule..." th:value="${search}"/>

    <!-- Wybór rozmiaru strony -->
    <label>Rozmiar strony:</label>
    <select name="size">
        <option th:value="2" th:text="'2'" th:selected="${size == 2}"></option>
        <option th:value="5" th:text="'5'" th:selected="${size == 5}"></option>
        <option th:value="10" th:text="'10'" th:selected="${size == 10}"></option>
    </select>

    <!-- Wybór sortowania -->
    <label>Sortuj wg:</label>
    <select name="sort">
        <option th:value="titleAsc" th:text="'Tytuł (A-Z)'" th:selected="${sort == 'titleAsc'}"></option>
        <option th:value="dateNewest" th:text="'Najnowsze'" th:selected="${sort == 'dateNewest'}"></option>
        <option th:value="dateOldest" th:text="'Najstarsze'" th:selected="${sort == 'dateOldest'}"></option>
        <option th:value="likes" th:text="'Polubienia'" th:selected="${sort == 'likes'}"></option>
    </select>

    <button type="submit">Szukaj/Sortuj</button>
</form>

<!-- Dodatkowy formularz do filtrowania po tagach (jeśli chcesz) -->
<form action="/allPosts" method="get">
    <input type="hidden" name="size" th:value="${size}"/>
    <input type="hidden" name="sort" th:value="${sort}"/>
    <!-- select tagów -->
    <select name="tagId">
        <option value="">-- dowolny tag --</option>
        <option th:each="tag : ${allTags}"
                th:value="${tag.id}"
                th:text="${tag.name}">
        </option>
    </select>
    <button type="submit">Filtruj tag</button>
</form>

<hr>

<!-- Lista postów -->
<ul>
    <li th:each="post : ${posts}">
        <a th:href="@{/showPost(postId=${post.id})}">
            <strong th:text="${post.title}">Tytuł wpisu</strong><br>
            <span th:text="${post.description}">Opis wpisu</span>
        </a>
        <br>
        <span>Liczba polubień:
            <b th:text="${postLikesCountMap[post.id]}">0</b>
        </span>
        <br>
        <!-- Like/Unlike -->
        <div th:if="${userLikedPosts.contains(post.id)}">
            <form th:action="@{/post/{id}/unlike(id=${post.id})}" method="post">
                <button type="submit">Unlike</button>
            </form>
        </div>
        <div th:unless="${userLikedPosts.contains(post.id)}">
            <form th:action="@{/post/{id}/like(id=${post.id})}" method="post">
                <button type="submit">Like</button>
            </form>
        </div>
        <br>
    </li>
</ul>

<!-- Nawigacja stron -->
<span th:each="number : ${numbers}">
    <a th:if="${number} != -1"
       th:href="@{/allPosts(size=${size}, page=${number}, sort=${sort}, search=${search})}"
       th:text="${number + 1}"></a>
    <span th:unless="${number} != -1">...</span>
</span>

<a th:href="@{/main}" th:text="#{showAllPosts.menuReturn}">Powrót do menu</a>
</body>
</html>